<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zimax.mcrs.device.mapper.DeviceUpgradeMapper">

    <!--查询记录数-->
    <select id="count" resultType="int">
        SELECT
        count(*)
        FROM
        dev_upgrade AS upg
        LEFT JOIN
        eqi_equipment AS eqi
        ON upg.equipment_int=eqi.equipment_int
        LEFT JOIN
        eqi_device AS dev
        ON upg.device_id=dev.device_id
        LEFT JOIN
        upd_upload AS upl
        ON upg.upload_id=upl.upload_id
        LEFT JOIN
        base_access_info AS bai
        ON eqi.acc_point_res_id = bai.acc_point_res_id
        LEFT JOIN
        base_process_info AS bpi
        ON bai.process_id = bpi.process_id
        LEFT JOIN
        base_factory_info AS bfi
        ON bpi.factory_id = bfi.factory_id
        <where>
            <if test="deviceName !=null and deviceName !=''">
                and dev.device_name LIKE '%${deviceName}%'
            </if>
            <if test="deviceSoftwareType !=null and deviceSoftwareType !=''">
                and dev.device_software_type LIKE '%${deviceSoftwareType}%'
            </if>
            <if test="version !=null and version !=''">
                and upl.version like '%${version}%'
            </if>
            <if test="versionUpdater !=null and versionUpdater !=''">
                and upg.version_updater like '%${versionUpdater}%'
            </if>
            <if test="versionUpdateTime !=null and versionUpdateTime !=''">
                and upg.version_update_time like '%${versionUpdateTime}%'
            </if>
        </where>
    </select>

    <!--查询所有-->
    <select id="queryAll" parameterType="map" resultType="com.zimax.mcrs.device.pojo.DeviceUpgradeVo">
        SELECT
        upg.device_upgrade_id,
        upg.equipment_int,
        upg.device_id,
        upg.upload_id,
        upg.upgrade_status,
        upl.version,
        upg.version_updater,
        upg.version_update_time,
        eqi.equipment_id,
        eqi.equipment_name,
        dev.device_name,
        dev.device_software_type,
        bfi.factory_name,
        upl.upload_number,
        dev.app_id
        FROM
        dev_upgrade AS upg
        LEFT JOIN
        eqi_equipment AS eqi
        ON upg.equipment_int=eqi.equipment_int
        LEFT JOIN
        eqi_device AS dev
        ON upg.device_id=dev.device_id
        LEFT JOIN
        upd_upload AS upl
        ON upg.upload_id=upl.upload_id
        LEFT JOIN
        base_access_info AS bai
        ON eqi.acc_point_res_id = bai.acc_point_res_id
        LEFT JOIN
        base_process_info AS bpi
        ON bai.process_id = bpi.process_id
        LEFT JOIN
        base_factory_info AS bfi
        ON bpi.factory_id = bfi.factory_id
        <where>
            <if test="deviceName !=null and deviceName !=''">
                and dev.device_name LIKE '%${deviceName}%'
            </if>
            <if test="deviceSoftwareType !=null and deviceSoftwareType !=''">
                and dev.device_software_type LIKE '%${deviceSoftwareType}%'
            </if>
            <if test="version !=null and version !=''">
                and upl.version like '%${version}%'
            </if>
            <if test="versionUpdater !=null and versionUpdater !=''">
                and upg.version_updater like '%${versionUpdater}%'
            </if>
            <if test="versionUpdateTime !=null and versionUpdateTime !=''">
                and upg.version_update_time like '%${versionUpdateTime}%'
            </if>
        </where>
        <if test="order !=null and order !=''">
            order by ${field} ${order}
        </if>
        <if test="limit !=null and limit !=''">
            limit ${begin},${limit}
        </if>
    </select>


    <update id="updateDeviceUpgrade" parameterType="com.zimax.mcrs.device.pojo.DeviceUpgrade">
        UPDATE dev_upgrade
        SET equipment_int          = #{equipmentInt},
            device_id              = #{deviceId},
            upload_id              = #{uploadId},
            upgrade_before_version = #{upgradeBeforeVersion},
            upgrade_status         = #{upgradeStatus},
            version_updater        = #{versionUpdater},
            version_update_time    = #{versionUpdateTime}
        WHERE device_upgrade_id = #{deviceUpgradeId}
    </update>

    <update id="updateDeviceUpgradeStatus" parameterType="com.zimax.mcrs.device.pojo.DeviceUpgrade">
        UPDATE dev_upgrade
        SET upgrade_status = #{upgradeStatus}
        WHERE device_upgrade_id = #{deviceUpgradeId}
    </update>

    <update id="updateDeviceUploadId" parameterType="com.zimax.mcrs.device.pojo.DeviceUpgrade">
        UPDATE dev_upgrade
        SET upload_id = #{uploadId},
            WHERE device_upgrade_id = #{deviceUpgradeId}
    </update>

    <!--新增-->
    <insert id="addDeviceUpgrade" parameterType="com.zimax.mcrs.device.pojo.DeviceUpgrade">
        insert into dev_upgrade
        values (#{deviceUpgradeId}, #{equipmentInt}, #{deviceId}, #{uploadId}, #{upgradeBeforeVersion},
                #{upgradeStatus},
                #{versionUpdater}, #{versionUpdateTime})
    </insert>

    <!--获取一条记录表信息-->
    <select id="getDeviceUpgrade" resultType="com.zimax.mcrs.device.pojo.DeviceUpgrade">
        select *
        from dev_upgrade
        WHERE device_upgrade_id = #{deviceUpgradeId}
    </select>

    <!--通过终端id获取当前的升级表主键-->
    <select id="queryRecordId" parameterType="map" resultType="com.zimax.mcrs.device.pojo.DeviceUploadUpgradeVo">
        SELECT *
        FROM dev_upgrade a
                 LEFT JOIN eqi_device b ON a.device_id = b.device_id
                 LEFT JOIN upd_upload c ON a.upload_id = c.upload_id
        WHERE upgrade_status = "100"
          AND a.device_id = #{deviceId}
    </select>

    <select id="queryRecordIdObject" resultType="com.zimax.mcrs.device.pojo.DeviceUploadUpgradeVo">
        SELECT *
        FROM dev_upgrade a
                 LEFT JOIN eqi_device b ON a.device_id = b.device_id
                 LEFT JOIN upd_upload c ON a.upload_id = c.upload_id
        WHERE upgrade_status = "100"
          AND a.device_id = #{deviceId}
    </select>

    <!--获取一个用户信息条数-->
    <select id="queryRecordIdCount" resultType="int">
        select count(*)
        FROM dev_upgrade a
                 LEFT JOIN eqi_device b ON a.device_id = b.device_id
                 LEFT JOIN upd_upload c ON a.upload_id = c.upload_id
        WHERE upgrade_status = "100"
          AND a.device_id = #{deviceId}
    </select>

    <select id="getVersion" resultType="com.zimax.mcrs.device.pojo.Device">
        SELECT *
        FROM eqi_device
        WHERE device_id = #{deviceId}
    </select>
</mapper>
