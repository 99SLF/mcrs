<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zimax.mcrs.device.mapper.DeviceUpgradeMapper">

    <!--查询记录数-->
    <select id="count" resultType="int">
        SELECT
        upg.device_upgrade_id,
        upg.equipment_int,
        upg.device_id,
        upg.upload_id,
        upg.upgrade_status,
        upg.upgrade_version,
        upg.version_updater,
        upg.version_update_time,
        eqi.equipment_id,
        eqi.equipment_name,
        dev.device_name,
        dev.device_software_type,
        dev.factory_name,
        count(upg.device_upgrade_id)
        FROM
        dev_upgrade AS upg
        LEFT JOIN
        eqi_equipment AS eqi
        ON upg.equipment_int=eqi.equipment_int
        LEFT JOIN
        eqi_device AS dev
        ON upg.device_id=dev.device_id
        <where>
            <if test="equipmentId !=null and equipmentId !=''">
                and eqi.equipment_id like '%${equipmentId}%'
            </if>
            <if test="upgradeVersion !=null and upgradeVersion !=''">
                and upg.upgrade_version like '%${upgradeVersion}%'
            </if>
        </where>
    </select>

    <!--查询所有-->
    <select id="queryAll" parameterType="map" resultType="com.zimax.mcrs.device.pojo.DeviceUpgradeVo">
        SELECT
        upg.device_upgrade_id,
        upg.equipment_int,
        upg.device_id,
        upg.upload_id,
        upg.upgrade_status,
        upg.upgrade_version,
        upg.version_updater,
        upg.version_update_time,
        eqi.equipment_id,
        eqi.equipment_name,
        dev.device_name,
        dev.device_software_type,
        dev.factory_name
        FROM
        dev_upgrade AS upg
        LEFT JOIN
        eqi_equipment AS eqi
        ON upg.equipment_int=eqi.equipment_int
        LEFT JOIN
        eqi_device AS dev
        ON upg.device_id=dev.device_id
        <where>
            <if test="equipmentId !=null and equipmentId !=''">
                and eqi.equipment_id LIKE '%${equipmentId}%'
            </if>
            <if test="upgradeVersion !=null and upgradeVersion !=''">
                and upg.upgrade_version like '%${upgradeVersion}%'
            </if>
            <if test="versionUpdater !=null and versionUpdater !=''">
                and upg.version_updater like '%${versionUpdater}%'
            </if>
            <if test="versionUpdateTime !=null and versionUpdateTime !=''">
                and upg.version_update_time like '%${versionUpdateTime}%'
            </if>
        </where>
        <if test="order !=null and order !=''">
            order by ${field} ${order}
        </if>
        <if test="limit !=null and limit !=''">
            limit ${begin},${limit}
        </if>
    </select>

<!--    &lt;!&ndash;注册终端&ndash;&gt;-->
<!--    <insert id="registrationDevice" parameterType="com.zimax.mcrs.device.pojo.Device">-->
<!--        insert into eqi_device-->
<!--        values (#{deviceId}, #{APPId}, #{version}, #{needUpdate},-->
<!--                #{deviceSoftwareType}, #{deviceName},-->
<!--                #{assessName}, #{factoryName}, #{assessType},-->
<!--                #{assessIp}, #{equipmentId},-->
<!--                #{assessAttributes}, #{assessInstallLocation},-->
<!--                #{accessMethod}, #{remarks}, #{creator},-->
<!--                #{createTime}, #{enable}, #{createRole},-->
<!--                #{updater}, #{updateTime})-->
<!--    </insert>-->

<!--    &lt;!&ndash;根据主键删除设备&ndash;&gt;-->
<!--    <delete id="logoutDevice" parameterType="int">-->
<!--        delete-->
<!--        from eqi_device-->
<!--        where device_id = #{deviceId}-->
<!--    </delete>-->

<!--    &lt;!&ndash;更新1条设备信息&ndash;&gt;-->
<!--    <update id="updateDevice" parameterType="com.zimax.mcrs.device.pojo.Device">-->
<!--        update eqi_device-->
<!--        set app_id = #{APPId},-->
<!--            device_software_type=#{deviceSoftwareType},-->
<!--            device_name=#{deviceName},-->
<!--            assess_name=#{assessName},-->
<!--            factory_name=#{factoryName},-->
<!--            assess_type=#{assessType},-->
<!--            assess_ip=#{assessIp},-->
<!--            equipment_id=#{equipmentId},-->
<!--            assess_attributes=#{assessAttributes},-->
<!--            assess_install_location=#{assessInstallLocation},-->
<!--            access_method=#{accessMethod},-->
<!--            enable=#{enable},-->
<!--            updater=#{updater},-->
<!--            update_time=#{updateTime}-->
<!--        where device_id = #{deviceId}-->
<!--    </update>-->

<!--    &lt;!&ndash;查询数据给监控&ndash;&gt;-->
<!--    <select id="toMonitor" parameterType="map" resultType="com.zimax.mcrs.device.pojo.Device">-->
<!--        select `equipment_id`,`app_id`,`device_software_type` ,`device_id`from eqi_device-->
<!--    </select>-->


</mapper>
